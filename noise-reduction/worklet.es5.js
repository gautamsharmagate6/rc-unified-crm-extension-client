/*   KRISP TECHNOLOGIES, INC
  __________________

  [2018] - [2023] Krisp Technologies, Inc
  All Rights Reserved.

  NOTICE: By accessing this programming code, you acknowledge that you have read, understood, and agreed to the User Agreement available at
  https://krisp.ai/terms-of-use.
  Please note that ALL information contained herein is and remains the property of Krisp Technologies, Inc., and its affiliates or assigns, if any. The intellectual property
  contained herein is proprietary to Krisp Technologies, Inc. and may be covered by pending and granted U.S. and Foreign Patents, and is further protected by
  copyright, trademark and/or other forms of intellectual property protection.
  Dissemination of this information or reproduction of this material IS STRICTLY FORBIDDEN.
 */
!function(){var t={61:function(t,e,r){var n=r(698).default;function o(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */t.exports=o=function(){return r},t.exports.__esModule=!0,t.exports.default=t.exports;var e,r={},i=Object.prototype,a=i.hasOwnProperty,u=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",l=s.asyncIterator||"@@asyncIterator",f=s.toStringTag||"@@toStringTag";function h(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(e){h=function(t,e,r){return t[e]=r}}function p(t,e,r,n){var o=e&&e.prototype instanceof m?e:m,i=Object.create(o.prototype),a=new x(n||[]);return u(i,"_invoke",{value:P(t,r,a)}),i}function v(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}r.wrap=p;var d="suspendedStart",y="suspendedYield",g="executing",_="completed",b={};function m(){}function E(){}function O(){}var w={};h(w,c,(function(){return this}));var A=Object.getPrototypeOf,R=A&&A(A(N([])));R&&R!==i&&a.call(R,c)&&(w=R);var S=O.prototype=m.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function D(t,e){function r(o,i,u,s){var c=v(t[o],t,i);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==n(f)&&a.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,u,s)}),(function(t){r("throw",t,u,s)})):e.resolve(f).then((function(t){l.value=t,u(l)}),(function(t){return r("throw",t,u,s)}))}s(c.arg)}var o;u(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}})}function P(t,r,n){var o=d;return function(i,a){if(o===g)throw new Error("Generator is already running");if(o===_){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var s=T(u,n);if(s){if(s===b)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=_,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=g;var c=v(t,r,n);if("normal"===c.type){if(o=n.done?_:y,c.arg===b)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=_,n.method="throw",n.arg=c.arg)}}}function T(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),b;var i=v(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,b;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,b):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,b)}function I(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(I,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(a.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(n(t)+" is not iterable")}return E.prototype=O,u(S,"constructor",{value:O,configurable:!0}),u(O,"constructor",{value:E,configurable:!0}),E.displayName=h(O,f,"GeneratorFunction"),r.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===E||"GeneratorFunction"===(e.displayName||e.name))},r.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,O):(t.__proto__=O,h(t,f,"GeneratorFunction")),t.prototype=Object.create(S),t},r.awrap=function(t){return{__await:t}},L(D.prototype),h(D.prototype,l,(function(){return this})),r.AsyncIterator=D,r.async=function(t,e,n,o,i){void 0===i&&(i=Promise);var a=new D(p(t,e,n,o),i);return r.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},L(S),h(S,f,"Generator"),h(S,c,(function(){return this})),h(S,"toString",(function(){return"[object Generator]"})),r.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},r.values=N,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return u.type="throw",u.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],u=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=a.call(i,"catchLoc"),c=a.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,b):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),b},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),k(r),b}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),b}},r}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},698:function(t){function e(r){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(r)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},687:function(t,e,r){var n=r(61)();t.exports=n;try{regeneratorRuntime=n}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,r),i.exports}r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,{a:e}),e},r.d=function(t,e){for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function n(t){var r=function(t,r){if("object"!==e(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,r||"default");if("object"!==e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"===e(r)?r:String(r)}function o(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,n(o.key),o)}}function i(t,e,r){return e&&o(t.prototype,e),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t,e){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},a(t,e)}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&a(t,e)}function s(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(t,r){if(r&&("object"===e(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return s(t)}function l(t){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},l(t)}function f(t,e,r){return f=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct.bind():function(t,e,r){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return r&&a(o,r.prototype),o},f.apply(null,arguments)}function h(t){var e="function"==typeof Map?new Map:void 0;return h=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return f(t,arguments,l(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),a(n,t)},h(t)}function p(){return p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=l(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},p.apply(this,arguments)}function v(t,e,r){return(e=n(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var d=128,y=function(t){return t.INIT_WASM_PROCESSOR="INIT_WASM_PROCESSOR",t.INPUT_AUDIO_DATA="INPUT_AUDIO_DATA",t.BUFFER_OVERFLOW="BUFFER_OVERFLOW",t.REQUEST_NOISE_CANCELATION="REQUEST_NOISE_CANCELATION",t.OUTPUT_CLEAN_AUDIO_DATA="OUTPUT_CLEAN_AUDIO_DATA",t.TOGGLE="TOGGLE",t.DISPOSE="DISPOSE",t.SUSPEND="SUSPEND",t.RESUME="RESUME",t.WASM_PROCESSOR_INITIALIZED="WASM_PROCESSOR_INITIALIZED",t.SET_AUDIO_PROCESSOR_READY="SET_AUDIO_PROCESSOR_READY",t.SET_LOGGING_PORT="SET_LOGGING_PORT",t}({});function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function _(t){return function(t){if(Array.isArray(t))return g(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return g(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t,e,r,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,o)}function m(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){b(i,n,o,a,u,"next",t)}function u(t){b(i,n,o,a,u,"throw",t)}a(void 0)}))}}var E,O=r(687),w=r.n(O),A=function(t){return t.LOG_INPUT_AUDIO="LOG_INPUT_AUDIO",t.LOG_OUTPUT_AUDIO="LOG_OUTPUT_AUDIO",t.LOG="LOG",t}({});function R(t){return(E=E||m(w().mark((function t(e){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,r){var n=new FileReader;n.onloadend=function(){return t(n.result)},n.readAsDataURL(e)})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function S(t,e){if(!t.length)return new Blob([],{type:"audio/wav; codecs=wav"});var r=t[0].length,n=new Float32Array(r*t.length);t.forEach((function(t,e){n.set(t,e*r)}));var o=function(t,e){var r=e.isFloat?Float32Array:Uint16Array,n=t.byteLength/r.BYTES_PER_ELEMENT,o=function(t){var e=t.numFrames,r=t.numChannels||2,n=t.isFloat?4:2,o=t.isFloat?3:1,i=t.sampleRate,a=r*n,u=i*a,s=e*a,c=new ArrayBuffer(44),l=new DataView(c),f=0;function h(t){for(var e=0;e<t.length;e++)l.setUint8(f+e,t.charCodeAt(e));f+=t.length}function p(t){l.setUint32(f,t,!0),f+=4}function v(t){l.setUint16(f,t,!0),f+=2}return h("RIFF"),p(s+36),h("WAVE"),h("fmt "),p(16),v(o),v(r),p(i),p(u),v(a),v(8*n),h("data"),p(s),new Uint8Array(c)}(Object.assign({},e,{numFrames:n})),i=new Uint8Array(o.length+t.byteLength);return i.set(o,0),i.set(new Uint8Array(t),o.length),i}(n.buffer,{isFloat:!0,numChannels:1,sampleRate:e});return new Blob([o],{type:"audio/wav;codecs=wav"})}var L=function(){function e(r){t(this,e),v(this,"_inputData",[]),v(this,"_outputData",[]),this.sampleRate=r}return i(e,[{key:"pushInput",value:function(t){this._inputData.push(t)}},{key:"pushOutput",value:function(t){this._outputData.push(t)}},{key:"exportToWavBlob",value:function(){return{input:S(this._inputData,this.sampleRate),output:S(this._outputData,this.sampleRate)}}}]),e}(),D=function(e){function r(){t(this,r),v(this,"logs",""),v(this,"threadName","main"),v(this,"instances",[]),v(this,"debugLogs",!1);var e="main";"undefined"!=typeof WorkerGlobalScope?e="worker":"undefined"!=typeof AudioWorkletProcessor&&(e="worklet"),this.threadName=e}return i(r,[{key:"setOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.debugLogs=t}},{key:"setLoggingPort",value:function(t){this.logPort=t}},{key:"info",value:function(){if(this.debugLogs){for(var t,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];this.postLog("I",r.join("\t")),(t=console).info.apply(t,["KrispSDK -"].concat(r))}}},{key:"warn",value:function(){if(this.debugLogs){for(var t,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];this.postLog("W",r.join("\t")),(t=console).info.apply(t,["KrispSDK -"].concat(r))}}},{key:"error",value:function(){if(this.debugLogs){for(var t,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];this.postLog("E",r.join("\t")),(t=console).error.apply(t,["KrispSDK -"].concat(r))}}},{key:"log",value:function(){if(this.debugLogs){for(var t,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];this.postLog("I",r.join("\t")),(t=console).log.apply(t,["KrispSDK -"].concat(r))}}},{key:"logAudioInputSamples",value:function(t){this.logAudio(A.LOG_INPUT_AUDIO,t)}},{key:"logAudioOutputSamples",value:function(t){this.logAudio(A.LOG_OUTPUT_AUDIO,t)}},{key:"collectFrom",value:function(t,e){var r=this,n={channel:new MessageChannel,recorder:void 0,startedAt:new Date,options:e};t instanceof MessagePort&&(n.recorder=new L(e.sampleRate)),t instanceof Window?this.logPort=n.channel.port2:t.postMessage({event:y.SET_LOGGING_PORT,data:void 0},[n.channel.port2]),n.channel.port1.addEventListener("message",(function(t){var e,o;"string"==typeof t.data?r.logs+=t.data:n.recorder&&(null===(e=t.data)||void 0===e?void 0:e.event)===A.LOG_INPUT_AUDIO?n.recorder.pushInput(t.data.data):n.recorder&&(null===(o=t.data)||void 0===o?void 0:o.event)===A.LOG_OUTPUT_AUDIO&&n.recorder.pushOutput(t.data.data)})),this.instances.push(n),n.channel.port1.start()}},{key:"downloadReport",value:function(){return(e=e||m(w().mark((function t(){var e,r,n,o,i,a,u;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,e=[],t.t0=w().keys(this.instances);case 3:if((t.t1=t.t0()).done){t.next=21;break}if(r=t.t1.value,!(n=this.instances[r]).recorder){t.next=19;break}return o=n.recorder.exportToWavBlob(),i=o.input,a=o.output,t.t2=e,t.t4="\n            <p>Recording: ".concat(n.startedAt,'<p>\n            <audio controls title="recording-input-').concat(r,'"><source src="'),t.next=12,R(i);case 12:return t.t5=t.sent,t.t3=t.t4.concat.call(t.t4,t.t5,'">Input</audio>\n            <audio controls title="recording-output-').concat(r,'"><source src="'),t.next=16,R(a);case 16:t.t6=t.sent,t.t7=t.t3.concat.call(t.t3,t.t6,'">Output</audio>\n          '),t.t2.push.call(t.t2,t.t7);case 19:t.next=3;break;case 21:return u="\n        <div>".concat(e,"</div>\n        <details>\n          <summary>Logs</summary>\n          <pre>").concat(this.logs,"</pre>\n        </details>\n      "),s="report-".concat((new Date).toISOString(),".html"),c=new Blob([u],{type:"text/html"}),l=void 0,f=void 0,l=window.URL.createObjectURL(c),(f=document.createElement("a")).href=l,f.download=s||"file",f.click(),t.abrupt("return",!0);case 26:return t.prev=26,t.t8=t.catch(0),console.error("KrispSDK - unable to download the report!"),t.abrupt("return",!1);case 30:case"end":return t.stop()}var s,c,l,f}),t,this,[[0,26]])})))).apply(this,arguments)}},{key:"logAudio",value:function(t,e){if(this.debugLogs&&this.logPort){var r=new Float32Array(e.length);r.set(e,0),this.logPort.postMessage({event:t,data:r},[r.buffer])}}},{key:"postLog",value:function(t,e){var r="[".concat((new Date).toLocaleString(),"][").concat(this.threadName,"][").concat(t,"]: ").concat(e,"\n");if(!this.logPort)return console.error("KrispSDK -","Logger is not initialized",r);this.logPort.postMessage(r)}}]),r}(),P=new D,T=function(){function e(){t(this,e),this.buffer=[]}return i(e,[{key:"push",value:function(t){var e;(e=this.buffer).push.apply(e,_(t))}},{key:"pull",value:function(t){if(t<0)throw new Error("Krisp SDK - Buffer wrong input");if(this.buffer.length>=t)return this.buffer.splice(0,t);throw new Error("Krisp SDK - Buffer not enough samples")}},{key:"length",value:function(){return this.buffer.length}},{key:"getBuffer",value:function(){return this.buffer}},{key:"empty",value:function(){this.buffer=[]}},{key:"dropBuffer",value:function(t){P.warn("ChunkAudioBuffer:dropBuffer","buffer reduced from:",this.buffer.length,"to:",this.buffer.length-40*t/10),this.buffer=this.buffer.slice(this.buffer.length-40*t/10)}}]),e}(),I=function(){function e(r,n){t(this,e),v(this,"_isReady",!1),v(this,"_suspended",!1),v(this,"_isEnabled",!1),v(this,"_previousLogNumber",0),v(this,"_previousLogTime",Date.now()),v(this,"_receivedPackagesCount",0),v(this,"_maxPackageDelay",0),v(this,"_overflowCount",0),v(this,"_previousReportedDelay",0),v(this,"events",{}),this.port=r,this.options=n,this.port.onmessage=this._onMessage.bind(this),this.on(y.TOGGLE,this.toggle),this.on(y.SUSPEND,this.suspend),this.on(y.RESUME,this.resume),this.on(y.SET_LOGGING_PORT,this.setLoggingPort),this.on(y.SET_AUDIO_PROCESSOR_READY,this.setReady),P.setOptions(n.debugLogs)}return i(e,[{key:"on",value:function(t,e){this.events[t]=e}},{key:"setLoggingPort",value:function(t,e){P.setLoggingPort(e.ports[0])}},{key:"_onMessage",value:function(t){var e,r=t.data,n=r.event,o=r.data;if(this.events[n])return null===(e=this.events[n])||void 0===e?void 0:e.call(this,o,t);P.error("AudioProcessor:_onMessage","Unhandled event received",t)}},{key:"isEnabled",get:function(){return this._isEnabled}},{key:"isSuspended",get:function(){return this._suspended}},{key:"isReady",get:function(){return this._isReady}},{key:"toggle",value:function(t){this._previousReportedDelay=0,this._isEnabled=void 0===t?!this._isEnabled:t}},{key:"suspend",value:function(){this._suspended=!0}},{key:"resume",value:function(){this._suspended=!1}},{key:"setReady",value:function(){this._isReady=!0}},{key:"_copyInputToOutput",value:function(t,e){var r;if(null===(r=t[0])||void 0===r||!r.length)return!0;for(var n=0;n<e[0].length;++n)e[0][n].set(t[0][n]);return!0}},{key:"log",value:function(t,e){var r=1e3*e/this.options.sampleRate;this.options.debugLogs&&(this._previousLogNumber!=t.seconds[0]&&(this._previousLogNumber=t.seconds[0],P.info("AudioProcessor:log",JSON.stringify({seconds:this._previousLogNumber,packagesCount:this._receivedPackagesCount,bufferDelayMS:1e3*e/this.options.sampleRate,maxPackageDelay:this._maxPackageDelay})),this._receivedPackagesCount=0,this._maxPackageDelay=0),this._receivedPackagesCount++,this._maxPackageDelay=Math.max(this._maxPackageDelay,Date.now()-this._previousLogTime),this._previousLogTime=Date.now()),r-this._previousReportedDelay>=this.options.bufferOverflowMS&&this.sendBufferOverflowEvent(r,!1)}},{key:"sendBufferOverflowEvent",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._overflowCount++,this._previousReportedDelay=t,this.port.postMessage({event:y.BUFFER_OVERFLOW,data:{overflowCount:this._overflowCount,bufferSizeMS:this._previousReportedDelay,isBufferDropped:e}})}}]),e}();function k(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=l(t);if(e){var o=l(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return c(this,r)}}var x=function(e){u(n,e);var r=k(n);function n(e,o){var i;return t(this,n),v(s(i=r.call(this,e,o)),"_outputBuffer",new T),i.on(y.OUTPUT_CLEAN_AUDIO_DATA,i.setCleanData),i.on(y.TOGGLE,i.toggle),i}return i(n,[{key:"toggle",value:function(t){p(l(n.prototype),"toggle",this).call(this,t),t||this._outputBuffer.empty()}},{key:"process",value:function(t,e,r){var n,o,i;if(this.isSuspended)return!1;if(null===(n=t[0])||void 0===n||!n.length)return!0;if(this.log(r,this._outputBuffer.length()),P.logAudioInputSamples(t[0][0]),!this.isEnabled||!this.isReady)return this._copyInputToOutput(t,e),P.logAudioOutputSamples(e[0][0]),!0;if(this.port.postMessage({event:y.INPUT_AUDIO_DATA,data:null==t||null===(o=t[0])||void 0===o?void 0:o[0]},[null==t||null===(i=t[0])||void 0===i||null===(i=i[0])||void 0===i?void 0:i.buffer]),this._outputBuffer.length()>=d)for(var a=this._outputBuffer.pull(d),u=0;u<e[0].length;++u)e[0][u].set(a);return P.logAudioOutputSamples(e[0][0]),!0}},{key:"getOutputBuffer",value:function(){return this._outputBuffer}},{key:"setCleanData",value:function(t){this.isEnabled&&this._outputBuffer.push(t),this._outputBuffer.length()>50*t.length&&(this.sendBufferOverflowEvent(this._outputBuffer.length(),!0),this._outputBuffer.dropBuffer(t.length))}}]),n}(I),N={READ_INDEX:0,WRITE_INDEX:1},U=function(){function e(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;t(this,e),v(this,"_channelData",[]),this._channelCount=n,this._state=new Uint32Array(new SharedArrayBuffer(Object.keys(N).length*Uint32Array.BYTES_PER_ELEMENT)),this._bufferLength=r+1;for(var o=0;o<n;o++)this._channelData.push(new Float32Array(new SharedArrayBuffer(this._bufferLength*Float32Array.BYTES_PER_ELEMENT)))}return i(e,[{key:"push",value:function(t,e){var r=Atomics.load(this._state,N.READ_INDEX),n=Atomics.load(this._state,N.WRITE_INDEX);if(this._getAvailableWrite(r,n)<e)return!1;var o=n+e;if(this._bufferLength<o){o-=this._bufferLength;for(var i=0;i<this._channelCount;i++){var a=this._channelData[i].subarray(n),u=this._channelData[i].subarray(0,o);a.set(t[i].subarray(0,a.length)),u.set(t[i].subarray(a.length))}}else{for(var s=0;s<this._channelCount;s++)this._channelData[s].subarray(n,o).set(t[s].subarray(0,e));o===this._bufferLength&&(o=0)}return Atomics.store(this._state,N.WRITE_INDEX,o),!0}},{key:"pull",value:function(t,e){var r=Atomics.load(this._state,N.READ_INDEX),n=Atomics.load(this._state,N.WRITE_INDEX);if(this._getAvailableRead(r,n)<e)return!1;var o=r+e;if(this._bufferLength<o){o-=this._bufferLength;for(var i=0;i<this._channelCount;i++){var a=this._channelData[i].subarray(r),u=this._channelData[i].subarray(0,o);t[i].set(a),t[i].set(u,a.length)}}else{for(var s=0;s<this._channelCount;++s)t[s].set(this._channelData[s].subarray(r,o));o===this._bufferLength&&(o=0)}return Atomics.store(this._state,N.READ_INDEX,o),!0}},{key:"printAvailableReadAndWrite",value:function(){var t=Atomics.load(this._state,N.READ_INDEX),e=Atomics.load(this._state,N.WRITE_INDEX);P.log(this,{availableRead:this._getAvailableRead(t,e),availableWrite:this._getAvailableWrite(t,e)})}},{key:"getAvailableSamples",value:function(){var t=Atomics.load(this._state,N.READ_INDEX),e=Atomics.load(this._state,N.WRITE_INDEX);return this._getAvailableRead(t,e)}},{key:"isFrameAvailable",value:function(t){return this.getAvailableSamples()>=t}},{key:"getBufferLength",value:function(){return this._bufferLength-1}},{key:"_getAvailableWrite",value:function(t,e){return e>=t?this._bufferLength-e+t-1:t-e-1}},{key:"_getAvailableRead",value:function(t,e){return e>=t?e-t:e+this._bufferLength-t}}],[{key:"from",value:function(t){return Object.setPrototypeOf(t,e.prototype)}}]),e}(),B={REQUEST_NOISE_CANCELLATION:0};function j(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=l(t);if(e){var o=l(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return c(this,r)}}var C=function(e){u(n,e);var r=j(n);function n(e,o){var i;t(this,n),v(s(i=r.call(this,e,o)),"_chunkSize",0),v(s(i),"_outputBuffer",new Float32Array(d));var a=o.sharedBuffers;if(!a)throw new Error("Krisp SDK - SharedArrayBuffer is not properly initialized!");return i._state=a.atomicState,i._inputRingBuffer=U.from(a.inputRingBuffer),i._outputRingBuffer=U.from(a.outputRingBuffer),i}return i(n,[{key:"process",value:function(t,e,r){var n,o,i,a,u;if(this.isSuspended)return!1;if(!this._state||null===(n=t[0])||void 0===n||!n.length)return!0;if(this.log(r,(null===(o=this._outputRingBuffer)||void 0===o?void 0:o.getAvailableSamples())||0),P.logAudioInputSamples(t[0][0]),!this.isEnabled||!this.isReady)return this._copyInputToOutput(t,e),P.logAudioOutputSamples(e[0][0]),!0;var s=t[0][0];if(null===(i=this._inputRingBuffer)||void 0===i||i.push([s],d),null===(a=this._outputRingBuffer)||void 0===a?void 0:a.pull([this._outputBuffer],d))for(var c=0;c<e[0].length;++c)e[0][c].set(this._outputBuffer);return null!==(u=this._inputRingBuffer)&&void 0!==u&&u.isFrameAvailable(this._chunkSize)&&Atomics.notify(this._state,B.REQUEST_NOISE_CANCELLATION),P.logAudioOutputSamples(e[0][0]),!0}}]),n}(I);function G(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=l(t);if(e){var o=l(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return c(this,r)}}registerProcessor("processor",function(e){u(n,e);var r=G(n);function n(e){var o;t(this,n),o=r.call(this);var i=e.processorOptions;return i.useSharedArrayBuffer?o.audioProcessor=new C(o.port,i):o.audioProcessor=new x(o.port,i),o}return i(n,[{key:"process",value:function(t,e,r){return this.audioProcessor.process(t,e,r)}}],[{key:"parameterDescriptors",get:function(){return[{name:"seconds",defaultValue:0,minValue:0,maxValue:36e3,automationRate:"a-rate"}]}}]),n}(h(AudioWorkletProcessor)))}()}();